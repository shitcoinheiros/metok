<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>MemeTok - Emoji Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body, html {
            margin: 0; padding: 0; height: 100%; width: 100%;
            overflow-x: hidden;
            overflow-y: hidden;
            background: #000;
            font-family: system-ui, -apple-system, sans-serif;
            position: fixed;
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        #feed {
            scroll-snap-type: y mandatory;
            overflow-y: scroll;
            overflow-x: hidden;
            height: 100vh;
            width: 100vw;
            scroll-behavior: auto;
            -webkit-overflow-scrolling: touch;
            position: relative;
            touch-action: pan-y;
        }

        .snap-item {
            scroll-snap-align: start;
            scroll-snap-stop: always;
            height: 100vh;
            width: 100vw;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #000;
            flex-shrink: 0;
            overflow: hidden;
        }

        .meme-bg-blur {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            filter: blur(80px) brightness(0.2);
            transform: scale(1.3);
            z-index: 0;
            pointer-events: none;
        }

        .meme-main {
            position: relative;
            z-index: 10;
            max-height: 70vh;
            max-width: 95%;
            object-fit: contain;
            border-radius: 8px;
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
            opacity: 0;
            transition: opacity 0.5s ease;
            transform: translateY(-12%);
            pointer-events: auto;
        }

        .overlay {
            position: absolute;
            inset: 0;
            pointer-events: none;
            z-index: 20;
            background: linear-gradient(0deg, rgba(0,0,0,0.8) 0%, transparent 50%, transparent 100%);
            padding-bottom: env(safe-area-inset-bottom);
            width: 100%;
        }
        
        .overlay button, .reaction-container { pointer-events: auto; }

        .btn-glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* SISTEMA DE REA√á√ÉO EMOJI - REDUZIDO EM 20% */
        .reaction-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            user-select: none;
        }

        .emoji-icon {
            font-size: 34px; /* Reduzido de 42px (~20%) */
            display: inline-block;
            text-shadow: 0 5px 15px rgba(0,0,0,0.3);
            animation: floatIdle 3s ease-in-out infinite;
            transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @media (min-width: 768px) {
            .emoji-icon { font-size: 42px; } /* Reduzido de 52px */
            .meme-main { max-height: 80vh; transform: translateY(-10%); }
        }

        @keyframes floatIdle {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-8px) rotate(3deg); }
        }

        .emoji-icon.active {
            animation: laughActive 0.6s ease-in-out infinite;
            filter: drop-shadow(0 0 10px rgba(251, 191, 36, 0.25));
        }

        @keyframes laughActive {
            0%, 100% { transform: scale(1.15) rotate(-8deg); }
            50% { transform: scale(1.3) rotate(8deg); }
        }

        #statusOverlay {
            position: fixed;
            top: env(safe-area-inset-top, 20px);
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            background: #fbbf24;
            color: black;
            padding: 10px 20px;
            border-radius: 50px;
            font-weight: 900;
            font-size: 10px;
            display: none;
            box-shadow: 0 10px 30px rgba(251, 191, 36, 0.4);
            letter-spacing: 0.1em;
            white-space: nowrap;
        }

        #loadingOverlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.85);
            z-index: 200;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(15px);
        }
    </style>
</head>
<body class="text-white select-none">

    <div id="statusOverlay">UPLOAD CONCLU√çDO! üöÄ</div>

    <div id="loadingOverlay">
        <div class="w-10 h-10 border-4 border-yellow-400 border-t-transparent rounded-full animate-spin mb-4"></div>
        <p id="loadingText" class="text-[9px] font-black tracking-[0.4em] text-center px-4">PROCESSANDO IPFS...</p>
    </div>

    <div id="feed" class="no-scrollbar"></div>

    <input type="file" id="fileInput" accept="image/*" class="hidden">

    <nav class="fixed bottom-0 left-0 right-0 flex justify-center items-center gap-4 z-50 p-6 pb-[calc(1.5rem+env(safe-area-inset-bottom))] bg-gradient-to-t from-black to-transparent">
        <button id="refreshBtn" class="w-12 h-12 md:w-14 md:h-14 btn-glass rounded-full flex items-center justify-center active:scale-90 transition-all">
            <i data-lucide="refresh-cw" class="w-5 h-5 md:w-6 md:h-6 opacity-60"></i>
        </button>
        
        <button id="uploadBtn" class="bg-white text-black h-12 md:h-14 px-8 md:px-12 rounded-full font-black text-[10px] md:text-[11px] tracking-[0.2em] md:tracking-[0.3em] shadow-2xl active:scale-95 transition-all uppercase">
            UPLOAD IPFS
        </button>

        <button class="w-12 h-12 md:w-14 md:h-14 btn-glass rounded-full flex items-center justify-center active:scale-90 transition-all">
            <i data-lucide="trophy" class="w-5 h-5 md:w-6 md:h-6 text-yellow-500"></i>
        </button>
    </nav>

    <script>
        const PINATA_JWT = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySW5mb3JtYXRpb24iOnsiaWQiOiIyYWEzYmZlZC05ZmFiLTRmMDYtYjAzYi1mZWZiMDI5OWQ3MDgiLCJlbWFpbCI6InNoaXRjb2luaGVpcm9zQGdtYWlsLmNvbSIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJwaW5fcG9saWN5Ijp7InJlZ2lvbnMiOlt7ImRlc2lyZWRSZXBsaWNhdGlvbkNvdW50IjoxLCJpZCI6IkZSQTEifSx7ImRlc2lyZWRSZXBsaWNhdGlvbkNvdW50IjoxLCJpZCI6Ik5ZQzEifV0sInZlcnNpb24iOjF9LCJtZmFfZW5hYmxlZCI6ZmFsc2UsInN0YXR1cyI6IkFDVElWRSJ9LCJhdXRoZW50aWNhdGlvblR5cGUiOiJzY29wZWRLZXkiLCJzY29wZWRLZXlLZXkiOiI3YjRiNmQ5OGM2ZDI5MTFlM2FiMiIsInNjb3BlZEtleVNlY3JldCI6ImY0ZWYzNjY1MzY3ODdiMjRkOGM4YmFlNGJiNTU3NGZiMTMyYmQ0YzRhMzI2ODY2MDU5OTY3N2M4NzE5ZWRhZTAiLCJleHAiOjE4MDEyNzMyMzN9.lUdaLbj_IpiRheeFaUPGNmEt8nbF_5hg0LoSBQNnM1U";
        const GATEWAY = "jade-detailed-slug-469.mypinata.cloud";

        let memes = [];
        const likedMemes = new Set();
        
        const feed = document.getElementById('feed');
        const fileInput = document.getElementById('fileInput');
        const uploadBtn = document.getElementById('uploadBtn');
        const refreshBtn = document.getElementById('refreshBtn');
        const statusOverlay = document.getElementById('statusOverlay');
        const loadingOverlay = document.getElementById('loadingOverlay');
        const loadingText = document.getElementById('loadingText');

        lucide.createIcons();

        function handleReactionClick(container, cid, rewardSpan) {
            const emojiEl = container.querySelector('.emoji-icon');
            emojiEl.innerText = 'üòÇ';
            emojiEl.classList.add('active');

            if (!likedMemes.has(cid)) {
                likedMemes.add(cid);
                const current = parseInt(rewardSpan.innerText);
                rewardSpan.innerText = current + 1;
                rewardSpan.classList.add('opacity-100', 'text-yellow-400');
                rewardSpan.classList.remove('opacity-60');
            }

            container.style.transform = 'scale(1.15)';
            setTimeout(() => container.style.transform = 'scale(1)', 200);
        }

        async function fetchPinataFiles() {
            loadingOverlay.style.display = 'flex';
            loadingText.innerText = "BUSCANDO NO IPFS...";
            try {
                const response = await fetch("https://api.pinata.cloud/data/pinList?status=pinned&pageLimit=20", {
                    method: 'GET',
                    headers: { 'Authorization': `Bearer ${PINATA_JWT.trim()}` }
                });
                const data = await response.json();
                memes = data.rows.map(item => ({
                    cid: item.ipfs_pin_hash,
                    url: `https://${GATEWAY}/ipfs/${item.ipfs_pin_hash}`,
                    rewards: Math.floor(Math.random() * 999)
                }));
                renderFeed();
            } catch (err) { console.error(err); } 
            finally { loadingOverlay.style.display = 'none'; }
        }

        function createItemElement(m) {
            const isLiked = likedMemes.has(m.cid);
            const div = document.createElement('div');
            div.className = 'snap-item';
            div.innerHTML = `
                <img src="${m.url}" class="meme-bg-blur">
                <img src="${m.url}" class="meme-main" onload="this.style.opacity=1">
                <div class="overlay">
                    <div class="absolute bottom-32 md:bottom-40 left-6 md:left-10 pr-20">
                        <span class="bg-yellow-400 text-black px-2 py-0.5 text-[8px] md:text-[9px] font-black tracking-tighter uppercase mb-2 md:mb-3 inline-block italic">IPFS STORAGE</span>
                        <h2 class="text-3xl md:text-4xl font-black italic tracking-tighter uppercase leading-[0.85]">Eterno<br>Meme</h2>
                        <p class="text-[7px] md:text-[8px] font-mono opacity-30 mt-2 truncate w-32 md:w-40">CID: ${m.cid.substring(0,20)}...</p>
                    </div>
                    <!-- Posi√ß√£o aproximada ao limite (90% do caminho para a borda lateral) -->
                    <div class="absolute right-[2px] md:right-1 bottom-36 md:bottom-44 flex flex-col items-center gap-6 md:gap-4">
                        <div class="reaction-container" id="react-${m.cid}">
                            <span class="emoji-icon ${isLiked ? 'active' : ''}">${isLiked ? 'üòÇ' : 'üòê'}</span>
                            <span class="reward-count text-[10px] md:text-[11px] font-black ${isLiked ? 'opacity-100 text-yellow-400' : 'opacity-60'} mt-[-2px] tabular-nums italic transition-all">
                                ${isLiked ? m.rewards + 1 : m.rewards}
                            </span>
                        </div>
                        <button class="w-10 h-10 md:w-12 md:h-12 bg-white text-black rounded-full flex items-center justify-center shadow-2xl active:scale-90 transition-transform">
                            <i data-lucide="share-2" class="w-4 h-4 md:w-5 md:h-5"></i>
                        </button>
                    </div>
                </div>
            `;
            
            const container = div.querySelector('.reaction-container');
            const rewardSpan = div.querySelector('.reward-count');
            container.onclick = () => handleReactionClick(container, m.cid, rewardSpan);

            return div;
        }

        function renderFeed() {
            feed.innerHTML = '';
            memes.forEach(m => feed.appendChild(createItemElement(m)));
            lucide.createIcons();
        }

        uploadBtn.addEventListener('click', () => fileInput.click());
        refreshBtn.addEventListener('click', fetchPinataFiles);

        fileInput.addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;
            loadingOverlay.style.display = 'flex';
            loadingText.innerText = "SUBINDO PARA O IPFS...";
            try {
                const formData = new FormData();
                formData.append('file', file);
                formData.append('pinataMetadata', JSON.stringify({ name: `MemeTok_${Date.now()}` }));
                const response = await fetch("https://api.pinata.cloud/pinning/pinFileToIPFS", {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${PINATA_JWT.trim()}` },
                    body: formData
                });
                if (!response.ok) throw new Error("Falha no upload");
                statusOverlay.style.display = 'block';
                setTimeout(() => {
                    statusOverlay.style.display = 'none';
                    fetchPinataFiles();
                }, 2000);
            } catch (err) { 
                console.error(err);
            } 
            finally { 
                loadingOverlay.style.display = 'none'; 
                fileInput.value = '';
            }
        });

        fetchPinataFiles();
    </script>
</body>
</html>
